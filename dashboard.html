<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dreams</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
<body class="bg-gray-100 p-4">
   <nav class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
        <div class="relative flex items-center justify-between h-16">
            <div class="flex items-center px-2 lg:px-0 xl:w-1/4">
                <div class="flex-shrink-0">
                    <img class="h-8 w-8" src="placeholder.jpg" alt="Icon">
                </div>
                <div class="hidden md:block md:ml-10">
                    <a href="#" class="font-medium text-gray-500 hover:text-gray-900">Validation</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Search bar-->
<div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8 py-4">
  <div class="relative text-gray-600">
      <input type="search" name="search" placeholder="Search" class="bg-white h-10 px-5 pr-10 rounded-full text-sm focus:outline-none">
      <button type="submit" class="absolute right-0 top-0 mt-3 mr-4">
          <svg class="h-4 w-4 fill-current" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 56.966 56.966" style="enable-background:new 0 0 56.966 56.966;" xml:space="preserve" width="512px" height="512px">
              <path d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92c0.779,0,1.518-0.297,2.079-0.837  C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17s-17-7.626-17-17S14.61,6,23.984,6z"/>
          </svg>
      </button>
  </div>
</div>

<!-- Search bar-->



  <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"
 
  >
    <!-- CARDS-->
    <div class="flex overflow-x-auto pb-6">
        <!-- Card 1 -->
        <div class="flex-shrink-0 w-full md:w-64 border rounded-lg overflow-hidden mx-2 bg-white shadow-lg
        transform transition duration-500 ease-in-out hover:-translate-y-1 hover:scale-110">
            <div class="p-4 text-gray-900">
                <h5 class="text-2xl font-bold">Title 1</h5>
                <p class="text-3xl">Body 1</p>
                <p class="text-sm text-gray-700">Foot 1</p>
            </div>
        </div>
        <!-- Card 2 -->
        <div class="flex-shrink-0 w-full md:w-64 border rounded-lg overflow-hidden mx-2 bg-white shadow-lg 
        transform transition duration-500 ease-in-out hover:-translate-y-1 hover:scale-110">
            <div class="p-4 text-gray-900">
                <h5 class="text-2xl font-bold">Title 2</h5>
                <p class="text-3xl">Body 2</p>
                <p class="text-sm text-gray-700">Foot 2</p>
            </div>
        </div>
        <!-- Add more cards as needed -->
    <!-- Card 3 -->
             <div class="flex-shrink-0 w-full md:w-64 border rounded-lg overflow-hidden mx-2 bg-white shadow-lg
             transform transition duration-500 ease-in-out hover:-translate-y-1 hover:scale-110">
            <div class="p-4 text-gray-900">
                <h5 class="text-2xl font-bold">Title 3</h5>
                <p class="text-3xl">Body 3</p>
                <p class="text-sm text-gray-700">Foot 3</p>
            </div>
        </div>
    </div>
    <!--CARDS-->   
</main>
<status>
<div style="display: flex; justify-content: center;">
  <div class="flex-shrink-0 w-full md:w-64 border rounded-lg overflow-hidden mx-2 bg-white shadow-lg
               transform transition duration-500 ease-in-out hover:-translate-y-1 hover:scale-110">
               <div class="p-4 text-gray-900">
                <h5 class="text-2xl font-bold">Status of dataset</h5>
                </div>       
      <div class="p-4 text-gray-900" style="display: flex; align-items: center;">
          <p style="flex-grow: 1; text-align: left;">Your Text</p>
          <i class="icon-class" style="text-align: right;">üîç</i> <!-- Replace 'icon-class' with the class of your desired icon -->
      </div>
  </div>
</div>
</status>
<!---Table 2-->
<div class="w-full border rounded-lg overflow-hidden mx-2 bg-white shadow-lg">
  <div class="p-4 text-gray-900">
      <h5 class="text-2xl font-bold">Summary</h5>
      <table class="text-3xl">
          <thead>
              <tr>
                  <th class="text-left text-gray-300">Field</th>
                  <th class="text-right text-gray-500">Total</th>
                  <th class=" text-right text-gray-300">%invalid</th>
              </tr>
          </thead>
          <tbody  id="tableBody">
          </tbody>
      </table>
  </div>
</div>
<!---Table 2-->



<div   id="excelData"> 
</div>
    <text>Dashboard</text>
    <input type="file" id="excelFileInput">
    <ul id="sheetNamesList"></ul>
    <text id ="data"></text>
    <script>


// Function to extract values for specified keys
function extractValues(obj, keys) {
    const extractedValues = {};
    keys.forEach(key => {
        if (obj.hasOwnProperty(key)) {
            extractedValues[key] = obj[key];
        }
    });
    return extractedValues;
}
/*--
THIS CLASS MANAGES  NavBar 
  member variables 
    +ipName: String 
    +ipIconUrl : String

  member functions 
  +getters 
--*/
class NavigationBar{

}

/*--
THIS CLASS MANAGES  CARDS 
  member variables 
    +faultyattributeName : String
    +numberOfRecordsWithFaultyAttribute : Integer 
    +pertangeofRecordsInError : Integer
 

  member functions 
  +getters 
--*/
class AttributeCard{
  constructor(faultyattributeName, numberOfRecordsWithFaultyAttribute, percentageOfRecordsInError) {
        this.faultyattributeName = faultyattributeName;
        this.numberOfRecordsWithFaultyAttribute = numberOfRecordsWithFaultyAttribute;
        this.percentageOfRecordsInError = percentageOfRecordsInError;
    }
}

/*--
THIS CLASS MANAGES  CARDS 
  member variables 
    +percentageError  : SInteger 
    +statusOfDataSet : String
    +icon: String 
  member functions 
  +getters 
--*/
class DataSetStatus{

}
/*--
THIS CLASS MANAGES DATA CARDS 
  member variables 
     +dataCards : List<AttrributeCard>

  member functions 
  +getters
  +getTotalofFaultyAttribute(faultyattributeName) : Integer
  +getPercentangeOfFaultyAttribute(faultyattributeName)
  +getExcelFileForFaultyAttr(faultyattributeName)
--*/
class DataCardManager{

  constructor (file){
    console.log('constructor called2');
    var excelToJson = new ExcelToJSON();
    /*populate dataCards with Statistics sheets data*/
    let _dataCards = excelToJson.parseExcelToSheetNames(file,(sheetNames,sheetData) => {
       this.displayData(sheetNames,sheetData);
    });     
    // sheetNames
    this.getSheetNames = function() {
    return this._dataCardsNames;};
    //attributeCards
    let _attributeCards = function(file){
    }
    // Function to extract values for specified keys
  
  };
/* Displays Attribute Cards 
@param sheetNames : List<String>
@param sheetData : 
*/
displayData(sheetNames, sheetData) {

  var sheetNames2 = this.removeDuplicates(sheetNames); 
  var sheetNames3 = this.removeFirstAndLast(sheetNames2);//useful for downloadables
  var sheetKeys =  this.extractKeysFromSheetData(sheetData);

  var attributeCards = this.createAttributeCardsFromSheetNames(sheetKeys, sheetData); 
  console.log("Data is coming"); 
  //console.log(sheetKeys);   

  var html = '<h2 class="text-xl font-semibold mb-4">Sheet Names:</h2>';
            html += '<ul class="mb-4">';
              sheetNames3.forEach(function(sheetName) {
                html += '<li>' + sheetName + '</li>';
            });
            html += '</ul>';

             html += '<h2 class="text-xl font-semibold mb-4">Sheet Data:</h2>';
            html += '<table class="table-auto w-full">';
            html += '<thead><tr>';
            Object.keys(sheetData[0]).forEach(function(key) {
                html += '<th class="px-4 py-2">' + key + '</th>';
            });
            html += '</tr></thead>';
            html += '<tbody>';
            sheetData.forEach(function(row) {
                html += '<tr>';
                Object.values(row).forEach(function(value) {
                    html += '<td class="border px-4 py-2">' + value + '</td>';
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
                        document.getElementById('excelData').innerHTML = html;
    }

    /**
     * removes duplicates entries in Json Array 
    */
    removeDuplicates(jsonArray) {
    return jsonArray.filter((item, index) => {
        const itemJson = JSON.stringify(item);
        return index === jsonArray.findIndex(obj => JSON.stringify(obj) === itemJson);
    });
}

/*
* removes first and last element in Json Array 
*/
 removeFirstAndLast(array) {
    if (array.length >= 2) {
        array.shift(); // Removes the first element
        array.pop(); // Removes the last element
    }
    return array;
}


/**
 *Creates a List<AttributeCard> Objects  by filtering sheetData for 
 * particular attributes namely 
 *                      No Old Person Case ID
 *                      No Old Person Case ID Percentage
                        Invalid National ID
                        Invalid National ID Percentage
                        Invalid DOB
                        Invalid DOB Percentage
                        Social Assets Yes, No Completio
                        Social Assets Yes, No Completio Percentange
                        Unusable Records
                        Unusable Records Percentage
*/
createAttributeCardsFromSheetNames(sheetNames3, sheetData){
 console.log(extractValues(sheetData, sheetNames3));
  return this.extractValues(sheetData, sheetNames3); 
}

extractValues(sheetData, sheetNames) {
    let result = [];
    let  mainList = sheetData[0];
    for (let i = 0; i < sheetNames.length; i++) {
        let key = sheetNames[i];    
        if ((mainList).hasOwnProperty(key)) {
          console.log("extractValues pass"); 
          console.log(key); 
            let faultyattributeName = key;
            let numberOfRecordsWithFaultyAttribute = mainList[key];
            console.log(numberOfRecordsWithFaultyAttribute);
            let percentageOfRecordsInError = 0; // Assuming the percentage is not calculated
            let myCard = new AttributeCard(faultyattributeName, numberOfRecordsWithFaultyAttribute, percentageOfRecordsInError);
            result.push(myCard);
        }
    }
    return result;
}
/*
extracts names of wanted fields 
*/
extractKeysFromSheetData(sheetData){
   var filtered = []; 
   Object.keys(sheetData[0]).forEach(function(key) {
               filtered.push(key)
            });
   return filtered;
}
}


/*--
THIS CLASS MANAGES  Table 
  member variables 
    +faultyattributeName : String 
    +pertangeofRecordsInError : Integer
    +totalRecordsWithFaultyAttribute : Integer 

  member functions 
  +getters 
--*/
class SummaryTable{
  constructor (file){
    console.log('summary constructor called');
    var excelToJson = new ExcelToJSON();
    /*populate dataCards with Statistics sheets data*/
    let _dataCards = excelToJson.parseExcelToSheetNames(file,(sheetNames,sheetData) => {
       this.displayData(sheetNames,sheetData);
    });     
    // sheetNames
    this.getSheetNames = function() {
    return this._dataCardsNames;};
    //attributeCards
    let _attributeCards = function(file){
    }
    // Function to extract values for specified key
  };




/* Displays Attribute Cards 
@param sheetNames : List<String>
@param sheetData : 
*/
displayData(sheetNames, sheetData) {

var sheetNames2 = this.removeDuplicates(sheetNames); 
var sheetNames3 = this.removeFirstAndLast(sheetNames2);//useful for downloadables
var sheetKeys =  this.extractKeysFromSheetData(sheetData);

var attributeCards = this.createAttributeCardsFromSheetNames(sheetKeys, sheetData); 


let tableBody = document.getElementById('tableBody');

// Populate the table with the AttributeCard objects
attributeCards.forEach((card) => {
    let row = document.createElement('tr');
    row.className = 'border-dotted border-t border-gray-200';

    let fieldCell = document.createElement('td');
    fieldCell.className = 'text-left text-2xl';
    fieldCell.textContent = card.faultyattributeName;

    let totalCell = document.createElement('td');
    totalCell.className = 'text-right text-2xl';
    totalCell.textContent = card.numberOfRecordsWithFaultyAttribute;

    let invalidCell = document.createElement('td');
    invalidCell.className = 'text-right text-2xl';
    invalidCell.textContent = card.percentageOfRecordsInError;

    row.appendChild(fieldCell);
    row.appendChild(totalCell);
    row.appendChild(invalidCell);
    tableBody.appendChild(row);
});
}
  /**
   * removes duplicates entries in Json Array 
  */
  removeDuplicates(jsonArray) {
  return jsonArray.filter((item, index) => {
      const itemJson = JSON.stringify(item);
      return index === jsonArray.findIndex(obj => JSON.stringify(obj) === itemJson);
  });
}
/*
* removes first and last element in Json Array 
*/
removeFirstAndLast(array) {
  if (array.length >= 2) {
      array.shift(); // Removes the first element
      array.pop(); // Removes the last element
  }
  return array;
}


/**
*Creates a List<AttributeCard> Objects  by filtering sheetData for 
* particular attributes namely 
*                      No Old Person Case ID
*                      No Old Person Case ID Percentage
                      Invalid National ID
                      Invalid National ID Percentage
                      Invalid DOB
                      Invalid DOB Percentage
                      Social Assets Yes, No Completio
                      Social Assets Yes, No Completio Percentange
                      Unusable Records
                      Unusable Records Percentage
*/
createAttributeCardsFromSheetNames(sheetNames3, sheetData){
console.log(extractValues(sheetData, sheetNames3));
return this.extractValues(sheetData, sheetNames3); 
}

extractValues(sheetData, sheetNames) {
  let result = [];
  let  mainList = sheetData[0];
  for (let i = 0; i < sheetNames.length; i++) {
    let max = sheetNames.length - 5;
      let key = sheetNames[i];  
      let nextKey = sheetNames[i+ 1];   
      if ((mainList).hasOwnProperty(key)) {
        console.log("extractValues pass"); 
        console.log(key); 
          let faultyattributeName = key;
          let numberOfRecordsWithFaultyAttribute = mainList[key];
          var percentageOfRecordsInError;
          console.log(numberOfRecordsWithFaultyAttribute);
          if (i  < max ){
          percentageOfRecordsInError = mainList[nextKey]; // Assuming the percentage is not calculated
            i= i+1;
        }
          else{
          percentageOfRecordsInError = 0;
          }
          let myCard = new AttributeCard(faultyattributeName, numberOfRecordsWithFaultyAttribute, percentageOfRecordsInError);
          result.push(myCard);
      }
  }
  return result;
}
/*
extracts names of wanted fields 
*/
extractKeysFromSheetData(sheetData){
 var filtered = []; 
 Object.keys(sheetData[0]).forEach(function(key) {
             filtered.push(key)
          });
 return filtered;
}
}

        var ExcelToJSON = function() {

      this.parseExcelToSheetNames = function(file, callback) {
      var reader = new FileReader();
      var sheetNames = [];
      reader.onload = function(e) {
        var data = e.target.result;
        var workbook = XLSX.read(data, { type: 'binary' });
        workbook.SheetNames.forEach(function(sheetName) {
            sheetNames.push(sheetName);
            console.log("Sheet Name: ~~~~", sheetName);
        });
        workbook.SheetNames.forEach(function(sheetName) {
                // Get sheet data
                sheetNames.push(sheetName);   
            });
            workbook.SheetNames.forEach(function(sheetName) {
                // Get sheet data
                if(sheetName === 'Statistics'){
                var sheetData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
                callback(sheetNames,sheetData); // Invoke the callback with sheetNames once they are fully populated
              }    
            });   
         };

    reader.onerror = function(ex) {
        console.error('An error occurred while reading the file:', ex);
        callback([]); // Invoke the callback with an empty list in case of an error
    };
    reader.readAsBinaryString(file);
};
};

    /*
        var excelFileInput = document.getElementById('results.xlsx'); // Replace with your actual file input element
       var excelToJson = new ExcelToJSON();
      excelFileInput.addEventListener('change', function(event) {
      var file = event.target.files[0];
       excelToJson.parseExcel(file)
    }); */ 
    var excelFileInput = document.getElementById('excelFileInput');
        var excelToJson = new ExcelToJSON();
        excelFileInput.addEventListener('change', function(event) {
            var file = event.target.files[0];
            console.log("loop");
            const mainManager = new SummaryTable(file); 
            console.log("loop2");
        // Assuming mainManager.getSheetNames() returns a Promise
      console.log(mainManager.getSheetNames());
    });
 /*STEPS 
     1. Initialize all dataCards
      2. Populate all dataCards
        3. InitializeDataSetStatus
         4. Initialize tableSummary */
         
        /*
        reads xlsx file , and gets attributes from Statistics sheet
        @returns list<AttrributeCard>
        */
</script>
</body>
</html>